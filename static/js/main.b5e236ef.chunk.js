(this["webpackJsonpgaol-plugin"]=this["webpackJsonpgaol-plugin"]||[]).push([[0],{140:function(e,t,n){},165:function(e,t){},167:function(e,t){},183:function(e,t,n){},184:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(10),o=n.n(c),i=n(119),l=n(234),s=n(235),u=n(21),d=n(118),p=n(13),j=n(224),b=n(111),f=n.n(b),m=n(123),x=n(35),h=n(221),g=n(17),v=n(106),O=n(11),y=n(14),w=n.n(y),C=n(22),N=function(){var e=Object(C.a)(w.a.mark((function e(t){var n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=k("say","text",t),e.next=4,window.callOverlayHandler(n);case 4:return e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),k=function(e,t,n){var a;return a={call:e},Object(O.a)(a,t,n),Object(O.a)(a,"key",t),Object(O.a)(a,"data",n),a},T={gaolRegex:/\|(.*)?\|2B6(B|C)\|.*?\|.*?\|/,nameRegex:/2B6(B|C)\|.*?\|.*?\|[A-Za-z ]+/,testRegex:/(.*)?(#-135-).*?/,testNameRegex:/#-135-[A-Za-z ]+/},S=T.gaolRegex,P=T.testRegex,R=T.nameRegex,I=T.testNameRegex,E=function(e,t){var n=e.findIndex((function(e){return t.includes(e)}));return[n,n>-1]},M=function(e,t){return e-t},D=function(e){var t=e.match(R),n=e.match(I);return t?t[0].split("|").pop():n?n[0].split("-").pop():null},B=n(16),L=n(20),G=n(61),z=n(23),A=n(110).createInstance({name:"gaoloverlay"});function U(e){return new Promise(function(){var t=Object(C.a)(w.a.mark((function t(n,a){return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,A.setItem("gaol",Object(z.a)({},e));case 3:n(!0),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),a(t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e,n){return t.apply(this,arguments)}}())}var F={players:[],meIndex:-1,countMatch:3,message:{nogaol:"Eating Titan's ass",gaol1:"1",gaol2:"2",gaol3:"3"},gaolLTE:Math.max(0,"3000"),gaolResetLTE:Math.max(0,"10000")},H=function(e,t){var n="";switch(t){case 3:n=e.gaol3||F.message.gaol3;break;case 2:n=e.gaol2||F.message.gaol2;break;case 1:n=e.gaol1||F.message.gaol1;break;case 0:n=e.nogaol||F.message.nogaol}return n},J={number:-1,players:[],gaoledPlayers:[],myNumber:-1,nog:3,status:"ready",error:"",message:F.message},X=Object(G.b)("gaol/fetchUserConfig",Object(C.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(){var e=Object(C.a)(w.a.mark((function e(t,n){var a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A.getItem("gaol");case 3:a=e.sent,t(a||{}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}());case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))),Z=Object(G.c)({name:"gaol",initialState:J,reducers:{order:function(e,t){e.number=t.payload},form:function(e,t){e.players=t.payload},position:function(e,t){e.myNumber=t.payload},error:function(e,t){e.error=t.payload},appendGaoledPlayer:function(e,t){var n=t.payload,a=e.gaoledPlayers.filter((function(e){return t=e.lte,!((new Date).getTime()>t);var t})),r=void 0!==a.find((function(e){return e.iplayer===n})),c={iplayer:n,lte:(new Date).getTime()+F.gaolLTE};e.gaoledPlayers=r?a:[].concat(Object(L.a)(a),[c]),r&&console.log("Duplicate player on gaol",n)},resetGaoledPlayer:function(e){e.gaoledPlayers=[]},setCustomMessage:function(e,t){e.message=t.payload}},extraReducers:function(e){e.addCase(X.pending,(function(e){e.status="loading"})).addCase(X.fulfilled,(function(e,t){e.status="ready",e.players=t.payload.players||e.players,e.myNumber=void 0!==t.payload.myNumber?t.payload.myNumber:e.myNumber,t.payload.message&&(e.message=t.payload.message)}))}}),_=Z.actions,q=_.order,W=_.form,Y=_.position,K=_.error,Q=_.appendGaoledPlayer,V=_.resetGaoledPlayer,$=_.setCustomMessage,ee=function(e){return e.gaol.number},te=function(e){return e.gaol.myNumber},ne=function(e){return e.gaol.players},ae=function(e){return e.gaol.error},re=function(e){return e.gaol.message},ce=function(){return function(e,t){var n=t().gaol.gaoledPlayers;if(3===n.length){var a=function(e,t){var n,a=t.map((function(e){return e}));return a.sort(M),[n=a.findIndex((function(t){return t===e}))+1,n>-1]}(te(t()),n.map((function(e){return e.iplayer}))),r=Object(B.a)(a,1)[0];console.log(new Date,n,r);var c=re(t()),o=H(c,r);o?N(o):(e(K("Alert message is invalid.")),setTimeout((function(){return e(K(""))}),1e4)),setTimeout((function(){e(V()),e(q(-1))}),F.gaolResetLTE),e(q(r))}}},oe=function(e){var t=e.players,n=e.myNumber,a=void 0===n?J.myNumber:n,r=e.message,c=void 0===r?null:r;return function(){var e=Object(C.a)(w.a.mark((function e(n){var r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={players:t,myNumber:a},c&&(r.message=c),e.next=4,U(r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},ie=Z.reducer,le=(n(140),n(3)),se=Object(h.a)((function(e){return{root:{display:"flex",justifyContent:"space-between",padding:"5px 8px",background:Object(g.a)("#000000",.5)},msgRoot:{display:"flex",flexDirection:"column",justifyContent:"center"},msg:{fontSize:"9px"},order:{color:e.palette.success.main},timer:{fontSize:"10px"},paper:{padding:e.spacing(2),textAlign:"center",color:e.palette.text.secondary}}}));var ue=function(){var e=Object(u.c)(ee),t=Object(u.c)(ae),n=Object(u.c)(re),r=se(),c=Object(u.b)();Object(a.useEffect)((function(){c(X());var e=[{name:"LogLine",event:o}];return function(e){try{e.forEach((function(e){window.addOverlayListener(e.name,(function(t){return e.event(t)}))})),window.startOverlayEvents(),console.log("Started Overlay plugin")}catch(t){console.error("Must import Overlay Plugin CDN"),console.error(t)}}(e),function(){return function(e){try{e.forEach((function(e){window.removeOverlayListener(e.name,(function(t){return e.event(t)}))})),console.log("Stopped Overlay plugin")}catch(t){console.error("Must import Overlay Plugin CDN"),console.error(t)}}(e)}}),[]);var o=Object(a.useCallback)((function(e){var t,n=e.rawLine;(t=n,S.test(t)||P.test(t))&&c(X()).then((function(){c(function(e){return function(t,n){var a=D,r=E(ne(n()),e),c=Object(B.a)(r,2),o=c[0];if(c[1])t(Q(o)),t(ce());else{t(V());var i=a(e);i&&(t(K("".concat(i," isn't in the party."))),setTimeout((function(){return t(K(""))}),3e3))}}}(n))}))}),[]);return Object(le.jsxs)(m.a,{className:r.root,variant:"outlined",elevation:3,children:[Object(le.jsxs)("div",{className:r.msgRoot,children:[Object(le.jsxs)(x.a,{variant:"subtitle1",children:["Gaol:",Object(le.jsx)("span",{children:" "}),Object(le.jsx)("span",{className:r.order,children:e>-1&&H(n,e)||"N/A"}),Object(le.jsx)("span",{children:" "}),e>-1&&Object(le.jsx)(v.a,{date:Date.now()+1e4,intervalDelay:0,precision:2,renderer:function(e){return Object(le.jsx)(x.a,{variant:"subtitle1",className:r.timer,display:"inline",children:"".concat(e.seconds,".").concat(e.milliseconds)})}})]}),Object(le.jsx)(x.a,{variant:"body2",className:r.msg,color:"error",children:t||""})]}),Object(le.jsx)("div",{children:Object(le.jsx)(j.a,{"aria-label":"setting",size:"small",onClick:function(){return function(){var e=String(window.location.search),t=-1!==e.indexOf("?")?"&":"?";e="".concat(e).concat(t);var n=window.location.href;window.open("".concat(n,"settings"),"","width=620,height=840,location=no,menubar=yes")}()},children:Object(le.jsx)(f.a,{})})})]})},de=n(2),pe=n(41),je=n(112),be=n.n(je),fe=n(232),me=n(238),xe=n(233),he=n(237),ge=n(225),ve=n(226),Oe=n(227),ye=n(117),we=n.n(ye),Ce=n(114),Ne=n.n(Ce),ke=n(116),Te=n.n(ke),Se=n(115),Pe=n.n(Se),Re=n(230),Ie=n(120),Ee=n(241),Me=n(228),De=n(229),Be=n(55),Le=function(e){var t={declaration:{attributes:{version:"1.0",encoding:"utf-8",standalone:"yes"}},elements:[]},n=e.map((function(e){return{type:"element",name:"Player",elements:[{type:"text",text:e}]}}));return t.elements.push({type:"element",name:"Priority",elements:n}),t},Ge=n(236),ze=n(239),Ae=n(113),Ue=n.n(Ae),Fe=Object(h.a)((function(e){return{characterRow:{display:"flex",justifyContent:"space-between",padding:"7px 6px"},no:{marginRight:"6px"}}}));var He=function(e){var t=e.name,n=void 0===t?"":t,a=e.selectMe,r=e.index,c=e.onChangeSelectMe,o=e.onTextInput,i=e.removeHandle,l=e.hiddenAction,s=Fe();return Object(le.jsxs)("div",{className:s.characterRow,children:[Object(le.jsxs)("div",{children:[Object(le.jsx)(x.a,{className:s.no,variant:"body2",component:"span",children:r+1}),Object(le.jsx)(ze.a,{size:"small",checked:a===r,value:r,onChange:function(){return c(r)}}),Object(le.jsx)(Ge.a,{label:"Character Name",value:n,type:"text",variant:"outlined",size:"small",onChange:function(e){return o(e.target.value,r)}})]}),!l&&Object(le.jsx)(j.a,{"aria-label":"remove",color:"secondary",size:"small",onClick:function(){return i(r)},children:Object(le.jsx)(Ue.a,{})})]})},Je={max:{fullParty:8,lightParty:4}};var Xe=function(e){var t=e.inputList,n=Object(h.a)((function(e){return{spaceTop:{marginTop:"30px"},inputRoot:{padding:"7px 6px"},inputMessage:{width:"75%"}}}))();return Object(le.jsxs)(ge.a,{style:{paddingBottom:0,marginTop:20},children:[Object(le.jsx)(ve.a,{title:"Custom Message",titleTypographyProps:{variant:"h6"}}),Object(le.jsxs)(Oe.a,{children:[t.map((function(e,t){return Object(le.jsx)("div",{className:n.inputRoot,children:Object(le.jsx)(Ge.a,{label:e.label,className:n.inputMessage,variant:"outlined",size:"small",value:e.value,onChange:e.onChange})},t)})),Object(le.jsx)(x.a,{variant:"subtitle2",color:"textSecondary",className:n.spaceTop,children:"- The message is upto 20 characters"})]})]})},Ze=Object(h.a)((function(e){return{actionDiv:{display:"flex",justifyContent:"flex-end",marginTop:10},cancelBtn:{margin:"0px 10px"},dnone:{display:"none"}}}));var _e=function(){var e=r.a.useState(!1),t=Object(B.a)(e,2),n=t[0],c=t[1],o=r.a.useState(null),i=Object(B.a)(o,2),l=i[0],s=i[1],d=Object(a.useState)({}),p=Object(B.a)(d,2),b=p[0],f=p[1],m=r.a.useRef(null),x=r.a.useRef(null),h=Object(u.c)(te),g=Object(u.c)(ne),v=Object(u.c)(re),O=Object(u.b)();r.a.useEffect((function(){O(X())}),[n]),r.a.useEffect((function(){f(v)}),[v]);var y=function(){s(null)},N=function(e){y(),O(W(g.filter((function(t,n){return n!==e}))))},k=function(){var e=Object(C.a)(w.a.mark((function e(){var t,n,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{y(),t=Le({}.players),n=Be.js2xml(t),a=new Blob([n],{type:"text/xml"}),function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsDataURL(e)}(a,(function(e){x.current.href=e,x.current.innerText=e,x.current.download="Priority.xml",x.current.click()}))}catch(r){console.error(r)}case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(e,t){var n=g.map((function(n,a){return a===t?e:n}));O(W(n))},S=function(e,t){var n=Object(z.a)({},b);t=Math.max(0,t.length)>20?t.slice(0,20):t,n[e]=t,f(n)},P=function(e){O(Y(e))},R=function(){var e=Object(C.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O($(b)),O(oe({players:g,myNumber:h,message:b})),alert("Saved successful.");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=Je.max.fullParty;return g.length===e?"Full Party":"Light Party"}(),E=Ze(),M=[{title:"New",icon:Object(le.jsx)(Ne.a,{fontSize:"small"}),action:function(){y(),g.length<Je.max.fullParty&&O(W([].concat(Object(L.a)(g),[""])))},disabled:g.length>=Je.max.fullParty},{title:"Import XML",icon:Object(le.jsx)(Pe.a,{fontSize:"small"}),action:function(){m.current.click()}},{title:"Export",icon:Object(le.jsx)(Te.a,{fontSize:"small"}),action:k,disabled:!0,display:!1}],D=[{label:"No Gaol",value:b.nogaol,onChange:function(e){return S("nogaol",e.target.value)}},{label:"Gaol 1",value:b.gaol1,onChange:function(e){return S("gaol1",e.target.value)}},{label:"Gaol 2",value:b.gaol2,onChange:function(e){return S("gaol2",e.target.value)}},{label:"Gaol 3",value:b.gaol3,onChange:function(e){return S("gaol3",e.target.value)}}];return Object(le.jsxs)("div",{children:[Object(le.jsxs)(ge.a,{style:{paddingBottom:0},children:[Object(le.jsx)(ve.a,{action:Object(le.jsx)(j.a,{onClick:function(e){s(e.currentTarget)},"aria-controls":"simple-menu","aria-haspopup":"true","aria-label":"more",children:Object(le.jsx)(we.a,{})}),title:"".concat(I),titleTypographyProps:{variant:"h6"},subheader:"The ones who are suffering in UwU."}),Object(le.jsx)(Ie.a,{id:"simple-menu",anchorEl:l,keepMounted:!0,open:Boolean(l),onClose:y,children:M.map((function(e,t){return void 0===e.display||e.display?Object(le.jsxs)(Ee.a,{onClick:e.action,disabled:void 0!==e.disabled&&e.disabled,children:[Object(le.jsx)(Me.a,{children:e.icon}),Object(le.jsx)(De.a,{primary:e.title})]},t):""}))}),Object(le.jsx)(Oe.a,{children:g.map((function(e,t){return Object(le.jsx)(He,{selectMe:h,index:t,name:e,onChangeSelectMe:P,onTextInput:T,removeHandle:N,hiddenAction:g.length<=1},t)}))})]}),Object(le.jsx)(Xe,{inputList:D}),Object(le.jsxs)("div",{className:E.actionDiv,children:[Object(le.jsx)(Re.a,{variant:"contained",color:"secondary",className:E.cancelBtn,onClick:function(){c((function(e){return!e}))},children:"Reset"}),Object(le.jsx)(Re.a,{variant:"contained",color:"primary",onClick:R,children:"Save"})]}),Object(le.jsx)("input",{type:"file",id:"import",ref:m,className:E.dnone,onChange:function(e){e.stopPropagation(),e.preventDefault(),y();var t=e.target.files[0],n=new FileReader;n.onload=function(e){try{var t=e.target.result,n=Be.xml2js(t);if(!n)throw"The reault of file's content is invalid, result: ".concat(n);var a=n.elements[0].elements.map((function(e){return e.elements[0].text}));O(W(a))}catch(r){alert("Cannot import XML file, please try again."),console.error(r)}},n.readAsText(t)},onClick:function(e){return e.target.value=null}})]})},qe=n(231);var We=function(){var e=Object(h.a)((function(e){return{spaceTop:{marginTop:"30px"}}}))();return Object(le.jsx)("div",{children:Object(le.jsx)(ge.a,{style:{paddingBottom:0},children:Object(le.jsxs)(Oe.a,{children:[Object(le.jsx)(x.a,{variant:"h6",color:"textSecondary",children:"Gaol Overlay"}),Object(le.jsxs)(x.a,{variant:"subtitle2",color:"textSecondary",children:["Developed by ",Object(le.jsx)(qe.a,{color:"primary",underline:"none",href:"https://na.finalfantasyxiv.com/lodestone/character/31961672/",target:"_blank",children:"Supskv"}),"."]}),Object(le.jsx)(x.a,{variant:"h6",color:"textSecondary",className:e.spaceTop,children:"Github"}),Object(le.jsx)(x.a,{variant:"subtitle2",color:"textSecondary",children:"See the latest code, changelog, and readme on Github. You can also submit bug reports or feature requests."}),Object(le.jsx)(qe.a,{underline:"none",href:"https://github.com/supskv/gaol-plugin",target:"_blank",children:"https://github.com/supskv/gaol-plugin"}),Object(le.jsx)(x.a,{variant:"subtitle2",color:"textSecondary",className:e.spaceTop,children:"version 0.1.20-alpha"})]})})})},Ye=n(85),Ke=n.n(Ye);var Qe=function(){var e=Object(a.useState)(""),t=Object(B.a)(e,2),n=t[0],r=t[1],c=Object(u.b)(),o=Object(h.a)((function(e){return{spaceTop:{marginTop:"30px"},actionDiv:{display:"flex",justifyContent:"center",marginTop:10},cancelBtn:{margin:"0px 10px"},importInput:{width:"100%"}}}))(),i=function(){var e=Object(C.a)(w.a.mark((function e(){var t,n,a,c,o;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,A.getItem("gaol");case 3:t=e.sent,n=t.players,a=Le(n),c=Be.js2xml(a),o=Ke.a.compressToEncodedURIComponent(c),r(o);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(le.jsx)("div",{children:Object(le.jsxs)(ge.a,{style:{paddingBottom:0},children:[Object(le.jsx)(ve.a,{title:"Import / Export",titleTypographyProps:{variant:"h6"}}),Object(le.jsxs)(Oe.a,{children:[Object(le.jsx)(Ge.a,{id:"import-field",label:"Paste text here",multiline:!0,rows:10,className:o.importInput,variant:"outlined",size:"small",value:n,onChange:function(e){r(e.target.value),console.log(n)}}),Object(le.jsxs)("div",{className:o.actionDiv,children:[Object(le.jsx)(Re.a,{variant:"contained",color:"secondary",className:o.cancelBtn,onClick:function(){try{var e=Ke.a.decompressFromEncodedURIComponent(n),t=Be.xml2js(e);if(!t)throw"The reault of the compress is invalid, result: ".concat(t);var a=t.elements[0].elements.map((function(e){return e.elements[0].text}));c(oe({players:a})),alert("Imported Successful.")}catch(r){alert("Cannot import, please try again."),console.error(r)}},children:"Import"}),Object(le.jsx)(Re.a,{variant:"contained",color:"primary",onClick:i,children:"Export"})]}),Object(le.jsx)(x.a,{variant:"subtitle2",color:"textSecondary",className:o.spaceTop,children:"- Import: Paste the code and click on import"}),Object(le.jsx)(x.a,{variant:"subtitle2",color:"textSecondary",children:"- Export: Generate code and copy to others"})]})]})})},Ve=["children","value","index"];function $e(e){var t=e.children,n=e.value,a=e.index,r=Object(de.a)(e,Ve);return Object(le.jsx)("div",Object(z.a)(Object(z.a)({role:"tabpanel",hidden:n!==a,id:"full-width-tabpanel-".concat(a),"aria-labelledby":"full-width-tab-".concat(a)},r),{},{children:n===a&&Object(le.jsx)(he.a,{p:3,children:t})}))}function et(e){return{id:"full-width-tab-".concat(e),"aria-controls":"full-width-tabpanel-".concat(e)}}var tt=function(){var e=Object(pe.a)(),t=Object(h.a)((function(e){return{root:{background:e.palette.background.default,height:"inherit"},tabpanel:{height:"100vh"}}}))(),n=r.a.useState(0),a=Object(B.a)(n,2),c=a[0],o=a[1];return Object(le.jsxs)("div",{className:t.root,children:[Object(le.jsx)(fe.a,{position:"sticky",color:"default",children:Object(le.jsxs)(me.a,{value:c,onChange:function(e,t){o(t)},indicatorColor:"primary",textColor:"primary",variant:"fullWidth","aria-label":"full width tabs example",children:[Object(le.jsx)(xe.a,Object(z.a)({label:"General"},et(0))),Object(le.jsx)(xe.a,Object(z.a)({label:"Import/Export"},et(1))),Object(le.jsx)(xe.a,Object(z.a)({label:"About"},et(2)))]})}),Object(le.jsxs)(be.a,{index:c,onChangeIndex:function(e){o(e)},children:[Object(le.jsx)($e,{value:c,index:0,dir:e.direction,className:t.tabpanel,children:Object(le.jsx)(_e,{})}),Object(le.jsx)($e,{value:c,index:1,dir:e.direction,className:t.tabpanel,children:Object(le.jsx)(Qe,{})}),Object(le.jsx)($e,{value:c,index:2,dir:e.direction,className:t.tabpanel,children:Object(le.jsx)(We,{})})]})]})};var nt=function(){return Object(le.jsx)(le.Fragment,{children:Object(le.jsx)(d.a,{children:Object(le.jsxs)(p.c,{children:[Object(le.jsx)(p.a,{exact:!0,path:"/",children:Object(le.jsx)(ue,{})}),Object(le.jsx)(p.a,{path:"/settings",children:Object(le.jsx)(tt,{})})]})})})},at=Object(G.a)({reducer:{gaol:ie}}),rt=(n(183),Object(i.a)({palette:{type:"dark"}}));o.a.render(Object(le.jsx)(r.a.StrictMode,{children:Object(le.jsxs)(l.a,{theme:rt,children:[Object(le.jsx)(s.a,{}),Object(le.jsx)(u.a,{store:at,children:Object(le.jsx)(nt,{})})]})}),document.getElementById("root"))}},[[184,1,2]]]);
//# sourceMappingURL=main.b5e236ef.chunk.js.map