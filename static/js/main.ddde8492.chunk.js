(this["webpackJsonpgaol-plugin"]=this["webpackJsonpgaol-plugin"]||[]).push([[0],{141:function(e,t,n){},166:function(e,t){},168:function(e,t){},184:function(e,t,n){},185:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(10),o=n.n(c),i=n(119),l=n(235),s=n(236),u=n(21),d=n(45),p=n.n(d),j=n(118),b=n(13),f=n(225),m=n(111),x=n.n(m),h=n(123),g=n(35),v=n(222),y=n(17),O=(n(139),n(11)),w=n(14),C=n.n(w),k=n(22),N=function(){var e=Object(k.a)(C.a.mark((function e(t){var n;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=T("say","text",t),e.next=4,window.callOverlayHandler(n);case 4:return e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),T=function(e,t,n){var a;return a={call:e},Object(O.a)(a,t,n),Object(O.a)(a,"key",t),Object(O.a)(a,"data",n),a},P={gaolRegex:/\|(.*)?\|2B6(B|C)\|.*?\|.*?\|/,nameRegex:/2B6(B|C)\|.*?\|.*?\|[A-Za-z ]+/,testRegex:/(.*)?(#-135-).*?/,testNameRegex:/#-135-[A-Za-z ]+/},S=P.gaolRegex,R=P.testRegex,I=P.nameRegex,E=P.testNameRegex,M=function(e,t){var n=e.findIndex((function(e){return t.includes(e)}));return[n,n>-1]},L=function(e,t){return e-t},G=function(e){var t=e.match(I),n=e.match(E);return t?t[0].split("|").pop():n?n[0].split("-").pop():null},B=n(16),z=n(20),D=n(62),A=n(23),U=n(110).createInstance({name:"gaoloverlay"});function F(e){return new Promise(function(){var t=Object(k.a)(C.a.mark((function t(n,a){return C.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,U.setItem("gaol",Object(A.a)({},e));case 3:n(!0),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),a(t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e,n){return t.apply(this,arguments)}}())}var H={players:[],meIndex:-1,countMatch:3,message:{nogaol:"Eating Titan's ass",gaol1:"1",gaol2:"2",gaol3:"3"},gaolLTE:Math.max(0,"10000"),gaolResetLTE:Math.max(0,"10000")},J=function(e,t){var n="";switch(t){case 3:n=e.gaol3||H.message.gaol3;break;case 2:n=e.gaol2||H.message.gaol2;break;case 1:n=e.gaol1||H.message.gaol1;break;case 0:n=e.nogaol||H.message.nogaol}return n},X={number:-1,players:[],gaoledPlayers:[],myNumber:-1,nog:3,status:"ready",error:"",message:H.message},Z=Object(D.b)("gaol/fetchUserConfig",Object(k.a)(C.a.mark((function e(){var t;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(){var e=Object(k.a)(C.a.mark((function e(t,n){var a;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U.getItem("gaol");case 3:a=e.sent,t(a||{}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}());case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))),_=Object(D.c)({name:"gaol",initialState:X,reducers:{order:function(e,t){e.number=t.payload},form:function(e,t){e.players=t.payload},position:function(e,t){e.myNumber=t.payload},error:function(e,t){e.error=t.payload},appendGaoledPlayer:function(e,t){var n={iplayer:t.payload};e.gaoledPlayers=[].concat(Object(z.a)(e.gaoledPlayers),[n])},removeGaoledPlayer:function(e,t){e.gaoledPlayers=e.gaoledPlayers.filter((function(e){return e.iplayer!==t.payload}))},resetGaoledPlayer:function(e){e.gaoledPlayers=[]},setCustomMessage:function(e,t){e.message=t.payload}},extraReducers:function(e){e.addCase(Z.pending,(function(e){e.status="loading"})).addCase(Z.fulfilled,(function(e,t){var n=t.payload.players||e.players,a=t.payload.myNumber;e.status="ready",e.players=n,e.myNumber=void 0!==a?a:e.myNumber,t.payload.message&&(e.message=t.payload.message),void 0!==n[a]&&p.a.identify("#".concat(a,"-").concat(n[a]||"unselect-index"))}))}}),q=_.actions,W=q.order,Y=q.form,K=q.position,Q=q.error,V=q.appendGaoledPlayer,$=q.removeGaoledPlayer,ee=q.resetGaoledPlayer,te=q.setCustomMessage,ne=function(e){return e.gaol.number},ae=function(e){return e.gaol.myNumber},re=function(e){return e.gaol.players},ce=function(e){return e.gaol.gaoledPlayers},oe=function(e){return e.gaol.error},ie=function(e){return e.gaol.message},le=function(){return function(e,t){var n=ce(t());if(3===n.length){var a=function(e,t){var n,a=t.map((function(e){return e}));return a.sort(L),[n=a.findIndex((function(t){return t===e}))+1,n>-1]}(ae(t()),n.map((function(e){return e.iplayer}))),r=Object(B.a)(a,1)[0];console.log((new Date).toLocaleString(),n.map((function(e){return e.iplayer})),r);var c=ie(t()),o=J(c,r);o?N(o):(e(Q("Alert message is invalid.")),setTimeout((function(){return e(Q(""))}),1e4)),setTimeout((function(){e(ee()),e(W(-1))}),H.gaolResetLTE),e(W(r))}}},se=function(e){var t=e.players,n=e.myNumber,a=void 0===n?X.myNumber:n,r=e.message,c=void 0===r?null:r;return function(){var e=Object(k.a)(C.a.mark((function e(n){var r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={players:t,myNumber:a},c&&(r.message=c),e.next=4,F(r);case 4:void 0!==t[a]&&p.a.identify("#".concat(a,"-").concat(t[a]||"unselect-index"));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},ue=_.reducer,de=(n(141),n(3)),pe=Object(v.a)((function(e){return{root:{display:"flex",justifyContent:"space-between",padding:"5px 8px",background:Object(y.a)("#000000",.5)},msgRoot:{display:"flex",flexDirection:"column",justifyContent:"center"},msg:{fontSize:"9px"},order:{color:e.palette.success.main},timer:{fontSize:"10px"},paper:{padding:e.spacing(2),textAlign:"center",color:e.palette.text.secondary}}}));var je=function(){var e=Object(u.c)(ne),t=Object(u.c)(oe),n=Object(u.c)(ie),r=pe(),c=Object(u.b)();Object(a.useEffect)((function(){c(Z());var e=[{name:"LogLine",event:o}];return function(e){try{e.forEach((function(e){window.addOverlayListener(e.name,(function(t){return e.event(t)}))})),window.startOverlayEvents(),console.log("Started Overlay plugin")}catch(t){console.error("Must import Overlay Plugin CDN"),console.error(t)}}(e),function(){return function(e){try{e.forEach((function(e){window.removeOverlayListener(e.name,(function(t){return e.event(t)}))})),console.log("Stopped Overlay plugin")}catch(t){console.error("Must import Overlay Plugin CDN"),console.error(t)}}(e)}}),[]);var o=Object(a.useCallback)((function(e){var t,n=e.rawLine;(t=n,S.test(t)||R.test(t))&&c(Z()).then((function(){c(function(e){return function(t,n){var a=G,r=M,c=ce(n()),o=r(re(n()),e),i=Object(B.a)(o,2),l=i[0];if(i[1])void 0!==c.find((function(e){return e.iplayer===l}))?console.log((new Date).toLocaleString(),"Duplicate player on gaol",l):(t(V(l)),setTimeout((function(){t($(l))}),H.gaolLTE),t(le()));else{t(ee());var s=a(e);s&&(t(Q("".concat(s," isn't in the party."))),setTimeout((function(){return t(Q(""))}),3e3))}}}(n))}))}),[]);return Object(de.jsxs)(h.a,{className:r.root,variant:"outlined",elevation:3,children:[Object(de.jsxs)("div",{className:r.msgRoot,children:[Object(de.jsxs)(g.a,{variant:"subtitle1",children:["Gaol:",Object(de.jsx)("span",{children:" "}),Object(de.jsx)("span",{className:r.order,children:e>-1&&J(n,e)||"N/A"}),Object(de.jsx)("span",{children:" "})]}),Object(de.jsx)(g.a,{variant:"body2",className:r.msg,color:"error",children:t||""})]}),Object(de.jsx)("div",{children:Object(de.jsx)(f.a,{"aria-label":"setting",size:"small",onClick:function(){return function(){var e=String(window.location.search),t=-1!==e.indexOf("?")?"&":"?";e="".concat(e).concat(t);var n=window.location.href;window.open("".concat(n,"settings"),"","width=620,height=840,location=no,menubar=yes")}()},children:Object(de.jsx)(x.a,{})})})]})},be=n(2),fe=n(41),me=n(112),xe=n.n(me),he=n(233),ge=n(239),ve=n(234),ye=n(238),Oe=n(226),we=n(227),Ce=n(228),ke=n(117),Ne=n.n(ke),Te=n(114),Pe=n.n(Te),Se=n(116),Re=n.n(Se),Ie=n(115),Ee=n.n(Ie),Me=n(231),Le=n(120),Ge=n(242),Be=n(229),ze=n(230),De=n(56),Ae=function(e){var t={declaration:{attributes:{version:"1.0",encoding:"utf-8",standalone:"yes"}},elements:[]},n=e.map((function(e){return{type:"element",name:"Player",elements:[{type:"text",text:e}]}}));return t.elements.push({type:"element",name:"Priority",elements:n}),t},Ue=n(237),Fe=n(240),He=n(113),Je=n.n(He),Xe=Object(v.a)((function(e){return{characterRow:{display:"flex",justifyContent:"space-between",padding:"7px 6px"},no:{marginRight:"6px"}}}));var Ze=function(e){var t=e.name,n=void 0===t?"":t,a=e.selectMe,r=e.index,c=e.onChangeSelectMe,o=e.onTextInput,i=e.removeHandle,l=e.hiddenAction,s=Xe();return Object(de.jsxs)("div",{className:s.characterRow,children:[Object(de.jsxs)("div",{children:[Object(de.jsx)(g.a,{className:s.no,variant:"body2",component:"span",children:r+1}),Object(de.jsx)(Fe.a,{size:"small",checked:a===r,value:r,onChange:function(){return c(r)}}),Object(de.jsx)(Ue.a,{label:"Character Name",value:n,type:"text",variant:"outlined",size:"small",onChange:function(e){return o(e.target.value,r)}})]}),!l&&Object(de.jsx)(f.a,{"aria-label":"remove",color:"secondary",size:"small",onClick:function(){return i(r)},children:Object(de.jsx)(Je.a,{})})]})},_e={max:{fullParty:8,lightParty:4}};var qe=function(e){var t=e.inputList,n=Object(v.a)((function(e){return{spaceTop:{marginTop:"30px"},inputRoot:{padding:"7px 6px"},inputMessage:{width:"75%"}}}))();return Object(de.jsxs)(Oe.a,{style:{paddingBottom:0,marginTop:20},children:[Object(de.jsx)(we.a,{title:"Custom Message",titleTypographyProps:{variant:"h6"}}),Object(de.jsxs)(Ce.a,{children:[t.map((function(e,t){return Object(de.jsx)("div",{className:n.inputRoot,children:Object(de.jsx)(Ue.a,{label:e.label,className:n.inputMessage,variant:"outlined",size:"small",value:e.value,onChange:e.onChange})},t)})),Object(de.jsx)(g.a,{variant:"subtitle2",color:"textSecondary",className:n.spaceTop,children:"- The message is upto 20 characters"})]})]})},We=Object(v.a)((function(e){return{actionDiv:{display:"flex",justifyContent:"flex-end",marginTop:10},cancelBtn:{margin:"0px 10px"},dnone:{display:"none"}}}));var Ye=function(){var e=r.a.useState(!1),t=Object(B.a)(e,2),n=t[0],c=t[1],o=r.a.useState(null),i=Object(B.a)(o,2),l=i[0],s=i[1],d=Object(a.useState)({}),p=Object(B.a)(d,2),j=p[0],b=p[1],m=r.a.useRef(null),x=r.a.useRef(null),h=Object(u.c)(ae),g=Object(u.c)(re),v=Object(u.c)(ie),y=Object(u.b)();r.a.useEffect((function(){y(Z())}),[n]),r.a.useEffect((function(){b(v)}),[v]);var O=function(){s(null)},w=function(e){O(),y(Y(g.filter((function(t,n){return n!==e}))))},N=function(){var e=Object(k.a)(C.a.mark((function e(){var t,n,a;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{O(),t=Ae({}.players),n=De.js2xml(t),a=new Blob([n],{type:"text/xml"}),function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsDataURL(e)}(a,(function(e){x.current.href=e,x.current.innerText=e,x.current.download="Priority.xml",x.current.click()}))}catch(r){console.error(r)}case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(e,t){var n=g.map((function(n,a){return a===t?e:n}));y(Y(n))},P=function(e,t){var n=Object(A.a)({},j);t=Math.max(0,t.length)>20?t.slice(0,20):t,n[e]=t,b(n)},S=function(e){y(K(e))},R=function(){var e=Object(k.a)(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y(te(j)),y(se({players:g,myNumber:h,message:j})),alert("Saved successful.");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=_e.max.fullParty;return g.length===e?"Full Party":"Light Party"}(),E=We(),M=[{title:"New",icon:Object(de.jsx)(Pe.a,{fontSize:"small"}),action:function(){O(),g.length<_e.max.fullParty&&y(Y([].concat(Object(z.a)(g),[""])))},disabled:g.length>=_e.max.fullParty},{title:"Import XML",icon:Object(de.jsx)(Ee.a,{fontSize:"small"}),action:function(){m.current.click()}},{title:"Export",icon:Object(de.jsx)(Re.a,{fontSize:"small"}),action:N,disabled:!0,display:!1}],L=[{label:"No Gaol",value:j.nogaol,onChange:function(e){return P("nogaol",e.target.value)}},{label:"Gaol 1",value:j.gaol1,onChange:function(e){return P("gaol1",e.target.value)}},{label:"Gaol 2",value:j.gaol2,onChange:function(e){return P("gaol2",e.target.value)}},{label:"Gaol 3",value:j.gaol3,onChange:function(e){return P("gaol3",e.target.value)}}];return Object(de.jsxs)("div",{children:[Object(de.jsxs)(Oe.a,{style:{paddingBottom:0},children:[Object(de.jsx)(we.a,{action:Object(de.jsx)(f.a,{onClick:function(e){s(e.currentTarget)},"aria-controls":"simple-menu","aria-haspopup":"true","aria-label":"more",children:Object(de.jsx)(Ne.a,{})}),title:"".concat(I),titleTypographyProps:{variant:"h6"},subheader:"The ones who are suffering in UwU."}),Object(de.jsx)(Le.a,{id:"simple-menu",anchorEl:l,keepMounted:!0,open:Boolean(l),onClose:O,children:M.map((function(e,t){return void 0===e.display||e.display?Object(de.jsxs)(Ge.a,{onClick:e.action,disabled:void 0!==e.disabled&&e.disabled,children:[Object(de.jsx)(Be.a,{children:e.icon}),Object(de.jsx)(ze.a,{primary:e.title})]},t):""}))}),Object(de.jsx)(Ce.a,{children:g.map((function(e,t){return Object(de.jsx)(Ze,{selectMe:h,index:t,name:e,onChangeSelectMe:S,onTextInput:T,removeHandle:w,hiddenAction:g.length<=1},t)}))})]}),Object(de.jsx)(qe,{inputList:L}),Object(de.jsxs)("div",{className:E.actionDiv,children:[Object(de.jsx)(Me.a,{variant:"contained",color:"secondary",className:E.cancelBtn,onClick:function(){c((function(e){return!e}))},children:"Reset"}),Object(de.jsx)(Me.a,{variant:"contained",color:"primary",onClick:R,children:"Save"})]}),Object(de.jsx)("input",{type:"file",id:"import",ref:m,className:E.dnone,onChange:function(e){e.stopPropagation(),e.preventDefault(),O();var t=e.target.files[0],n=new FileReader;n.onload=function(e){try{var t=e.target.result,n=De.xml2js(t);if(!n)throw"The reault of file's content is invalid, result: ".concat(n);var a=n.elements[0].elements.map((function(e){return e.elements[0].text}));y(Y(a))}catch(r){alert("Cannot import XML file, please try again."),console.error(r)}},n.readAsText(t)},onClick:function(e){return e.target.value=null}})]})},Ke=n(232);var Qe=function(){var e=Object(v.a)((function(e){return{spaceTop:{marginTop:"30px"}}}))();return Object(de.jsx)("div",{children:Object(de.jsx)(Oe.a,{style:{paddingBottom:0},children:Object(de.jsxs)(Ce.a,{children:[Object(de.jsx)(g.a,{variant:"h6",color:"textSecondary",children:"Gaol Overlay"}),Object(de.jsxs)(g.a,{variant:"subtitle2",color:"textSecondary",children:["Developed by ",Object(de.jsx)(Ke.a,{color:"primary",underline:"none",href:"https://na.finalfantasyxiv.com/lodestone/character/31961672/",target:"_blank",children:"Supskv"}),"."]}),Object(de.jsx)(g.a,{variant:"h6",color:"textSecondary",className:e.spaceTop,children:"Github"}),Object(de.jsx)(g.a,{variant:"subtitle2",color:"textSecondary",children:"See the latest code, changelog, and readme on Github. You can also submit bug reports or feature requests."}),Object(de.jsx)(Ke.a,{underline:"none",href:"https://github.com/supskv/gaol-plugin",target:"_blank",children:"https://github.com/supskv/gaol-plugin"}),Object(de.jsx)(g.a,{variant:"subtitle2",color:"textSecondary",className:e.spaceTop,children:"version 0.1.20-alpha"})]})})})},Ve=n(86),$e=n.n(Ve);var et=function(){var e=Object(a.useState)(""),t=Object(B.a)(e,2),n=t[0],r=t[1],c=Object(u.b)(),o=Object(v.a)((function(e){return{spaceTop:{marginTop:"30px"},actionDiv:{display:"flex",justifyContent:"center",marginTop:10},cancelBtn:{margin:"0px 10px"},importInput:{width:"100%"}}}))(),i=function(){var e=Object(k.a)(C.a.mark((function e(){var t,n,a,c,o;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,U.getItem("gaol");case 3:t=e.sent,n=t.players,a=Ae(n),c=De.js2xml(a),o=$e.a.compressToEncodedURIComponent(c),r(o);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(de.jsx)("div",{children:Object(de.jsxs)(Oe.a,{style:{paddingBottom:0},children:[Object(de.jsx)(we.a,{title:"Import / Export",titleTypographyProps:{variant:"h6"}}),Object(de.jsxs)(Ce.a,{children:[Object(de.jsx)(Ue.a,{id:"import-field",label:"Paste text here",multiline:!0,rows:10,className:o.importInput,variant:"outlined",size:"small",value:n,onChange:function(e){r(e.target.value),console.log(n)}}),Object(de.jsxs)("div",{className:o.actionDiv,children:[Object(de.jsx)(Me.a,{variant:"contained",color:"secondary",className:o.cancelBtn,onClick:function(){try{var e=$e.a.decompressFromEncodedURIComponent(n),t=De.xml2js(e);if(!t)throw"The reault of the compress is invalid, result: ".concat(t);var a=t.elements[0].elements.map((function(e){return e.elements[0].text}));c(se({players:a})),alert("Imported Successful.")}catch(r){alert("Cannot import, please try again."),console.error(r)}},children:"Import"}),Object(de.jsx)(Me.a,{variant:"contained",color:"primary",onClick:i,children:"Export"})]}),Object(de.jsx)(g.a,{variant:"subtitle2",color:"textSecondary",className:o.spaceTop,children:"- Import: Paste the code and click on import"}),Object(de.jsx)(g.a,{variant:"subtitle2",color:"textSecondary",children:"- Export: Generate code and copy to others"})]})]})})},tt=["children","value","index"];function nt(e){var t=e.children,n=e.value,a=e.index,r=Object(be.a)(e,tt);return Object(de.jsx)("div",Object(A.a)(Object(A.a)({role:"tabpanel",hidden:n!==a,id:"full-width-tabpanel-".concat(a),"aria-labelledby":"full-width-tab-".concat(a)},r),{},{children:n===a&&Object(de.jsx)(ye.a,{p:3,children:t})}))}function at(e){return{id:"full-width-tab-".concat(e),"aria-controls":"full-width-tabpanel-".concat(e)}}var rt=function(){var e=Object(fe.a)(),t=Object(v.a)((function(e){return{root:{background:e.palette.background.default,height:"inherit"},tabpanel:{height:"100vh"}}}))(),n=r.a.useState(0),a=Object(B.a)(n,2),c=a[0],o=a[1];return Object(de.jsxs)("div",{className:t.root,children:[Object(de.jsx)(he.a,{position:"sticky",color:"default",children:Object(de.jsxs)(ge.a,{value:c,onChange:function(e,t){o(t)},indicatorColor:"primary",textColor:"primary",variant:"fullWidth","aria-label":"full width tabs example",children:[Object(de.jsx)(ve.a,Object(A.a)({label:"General"},at(0))),Object(de.jsx)(ve.a,Object(A.a)({label:"Import/Export"},at(1))),Object(de.jsx)(ve.a,Object(A.a)({label:"About"},at(2)))]})}),Object(de.jsxs)(xe.a,{index:c,onChangeIndex:function(e){o(e)},children:[Object(de.jsx)(nt,{value:c,index:0,dir:e.direction,className:t.tabpanel,children:Object(de.jsx)(Ye,{})}),Object(de.jsx)(nt,{value:c,index:1,dir:e.direction,className:t.tabpanel,children:Object(de.jsx)(et,{})}),Object(de.jsx)(nt,{value:c,index:2,dir:e.direction,className:t.tabpanel,children:Object(de.jsx)(Qe,{})})]})]})};var ct=function(){return Object(de.jsx)(de.Fragment,{children:Object(de.jsx)(j.a,{children:Object(de.jsxs)(b.c,{children:[Object(de.jsx)(b.a,{exact:!0,path:"/",children:Object(de.jsx)(je,{})}),Object(de.jsx)(b.a,{path:"/settings",children:Object(de.jsx)(rt,{})})]})})})},ot=Object(D.a)({reducer:{gaol:ue},middleware:function(e){return e().concat(p.a.reduxMiddleware())}});n(184);p.a.init("pmwhh1/gaol-plugin");var it=Object(i.a)({palette:{type:"dark"}});o.a.render(Object(de.jsx)(r.a.StrictMode,{children:Object(de.jsxs)(l.a,{theme:it,children:[Object(de.jsx)(s.a,{}),Object(de.jsx)(u.a,{store:ot,children:Object(de.jsx)(ct,{})})]})}),document.getElementById("root"))}},[[185,1,2]]]);
//# sourceMappingURL=main.ddde8492.chunk.js.map