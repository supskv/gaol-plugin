(this["webpackJsonpgaol-plugin"]=this["webpackJsonpgaol-plugin"]||[]).push([[0],{140:function(e,t,n){},165:function(e,t){},167:function(e,t){},183:function(e,t,n){},184:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(10),o=n.n(c),i=n(117),l=n(234),s=n(235),u=n(25),d=n(116),p=n(13),j=n(224),f=n(109),b=n.n(f),m=n(121),x=n(35),h=n(221),v=n(16),O=n(104),y=n(11),g=n(14),w=n.n(g),k=n(21),C=function(){var e=Object(k.a)(w.a.mark((function e(t){var n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=N("say","text",t),e.next=4,window.callOverlayHandler(n);case 4:return e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),N=function(e,t,n){var a;return a={call:e},Object(y.a)(a,t,n),Object(y.a)(a,"key",t),Object(y.a)(a,"data",n),a},P={gaolRegex:/\|(.*)?\|2B6(B|C)\|.*?\|.*?\|/,nameRegex:/2B6(B|C)\|.*?\|.*?\|[A-Za-z ]+/,testRegex:/(.*)?(#-135-).*?/,testNameRegex:/#-135-[A-Za-z ]+/},S=P.gaolRegex,T=P.testRegex,R=P.nameRegex,I=P.testNameRegex,D=function(e,t){var n=e.findIndex((function(e){return t.includes(e)}));return[n,n>-1]},E=function(e,t){return e-t},B=function(e){var t=e.match(R),n=e.match(I);return t?t[0].split("|").pop():n?n[0].split("-").pop():null},z=n(18),G=n(20),M=n(61),A=n(28),L=n(108).createInstance({name:"gaoloverlay"});function U(e){return new Promise(function(){var t=Object(k.a)(w.a.mark((function t(n,a){return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,L.setItem("gaol",Object(A.a)({},e));case 3:n(!0),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),a(t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e,n){return t.apply(this,arguments)}}())}var F={number:-1,players:[],gaoledPlayers:[],myNumber:-1,nog:3,status:"ready",error:""},H=Object(M.b)("gaol/fetchUserConfig",Object(k.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(){var e=Object(k.a)(w.a.mark((function e(t,n){var a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,L.getItem("gaol");case 3:a=e.sent,t(a||{}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}());case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))),J=Object(M.c)({name:"gaol",initialState:F,reducers:{order:function(e,t){e.number=t.payload},form:function(e,t){e.players=t.payload},position:function(e,t){e.myNumber=t.payload},error:function(e,t){e.error=t.payload},appendGaoledPlayer:function(e,t){var n=t.payload,a=e.gaoledPlayers.filter((function(e){return t=e.lte,!((new Date).getTime()>t);var t})),r=void 0!==a.find((function(e){return e.iplayer===n})),c={iplayer:n,lte:(new Date).getTime()+3e3};e.gaoledPlayers=r?a:[].concat(Object(G.a)(a),[c]),r&&console.log("Duplicate player on gaol",n)},resetGaoledPlayer:function(e){e.gaoledPlayers=[]}},extraReducers:function(e){e.addCase(H.pending,(function(e){e.status="loading"})).addCase(H.fulfilled,(function(e,t){e.status="ready",e.players=t.payload.players||e.players,e.myNumber=void 0!==t.payload.myNumber?t.payload.myNumber:e.myNumber}))}}),X=J.actions,Z=X.order,_=X.form,q=X.position,W=X.error,Y=X.appendGaoledPlayer,K=X.resetGaoledPlayer,Q=function(e){return e.gaol.number},V=function(e){return e.gaol.myNumber},$=function(e){return e.gaol.players},ee=function(e){return e.gaol.error},te=function(){return function(e,t){var n=t().gaol.gaoledPlayers;if(3===n.length){var a=function(e,t){var n,a=t.map((function(e){return e}));return a.sort(E),[n=a.findIndex((function(t){return t===e}))+1,n>-1]}(V(t()),n.map((function(e){return e.iplayer}))),r=Object(z.a)(a,1)[0];console.log(new Date,n,r),C(r||"Eating Titan's ass."),setTimeout((function(){e(K()),e(Z(-1))}),1e4),e(Z(r))}}},ne=function(e){var t=e.players,n=e.myNumber,a=void 0===n?F.myNumber:n;return function(){var e=Object(k.a)(w.a.mark((function e(n){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U({players:t,myNumber:a});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},ae=J.reducer,re=(n(140),n(3)),ce=Object(h.a)((function(e){return{root:{display:"flex",justifyContent:"space-between",padding:"5px 8px",background:Object(v.a)("#000000",.5)},msgRoot:{display:"flex",flexDirection:"column",justifyContent:"center"},msg:{fontSize:"9px"},order:{color:e.palette.success.main},timer:{fontSize:"10px"},paper:{padding:e.spacing(2),textAlign:"center",color:e.palette.text.secondary}}}));var oe=function(){var e=Object(u.c)(Q),t=Object(u.c)(ee),n=ce(),r=Object(u.b)();Object(a.useEffect)((function(){r(H());var e=[{name:"LogLine",event:c}];return function(e){try{e.forEach((function(e){window.addOverlayListener(e.name,(function(t){return e.event(t)}))})),window.startOverlayEvents(),console.log("Started Overlay plugin")}catch(t){console.error("Must import Overlay Plugin CDN"),console.error(t)}}(e),function(){return function(e){try{e.forEach((function(e){window.removeOverlayListener(e.name,(function(t){return e.event(t)}))})),console.log("Stopped Overlay plugin")}catch(t){console.error("Must import Overlay Plugin CDN"),console.error(t)}}(e)}}),[]);var c=Object(a.useCallback)((function(e){var t,n=e.rawLine;(t=n,S.test(t)||T.test(t))&&r(H()).then((function(){r(function(e){return function(t,n){var a=B,r=D($(n()),e),c=Object(z.a)(r,2),o=c[0];if(c[1])t(Y(o)),t(te());else{t(K());var i=a(e);i&&(t(W("".concat(i," isn't in the party."))),setTimeout((function(){return t(W(""))}),3e3))}}}(n))}))}),[]);return Object(re.jsxs)(m.a,{className:n.root,variant:"outlined",elevation:3,children:[Object(re.jsxs)("div",{className:n.msgRoot,children:[Object(re.jsxs)(x.a,{variant:"p",children:["Gaol:",Object(re.jsx)("span",{children:" "}),Object(re.jsx)(x.a,{variant:"subtitle1",className:n.order,display:"inline",children:e>-1?e||"Eating Titan's ass.":"N/A"}),Object(re.jsx)("span",{children:" "}),e>-1&&Object(re.jsx)(O.a,{date:Date.now()+1e4,intervalDelay:0,precision:2,renderer:function(e){return Object(re.jsx)(x.a,{variant:"subtitle1",className:n.timer,display:"inline",children:"".concat(e.seconds,".").concat(e.milliseconds)})}})]}),Object(re.jsx)(x.a,{variant:"body2",className:n.msg,color:"error",children:t||""})]}),Object(re.jsx)("div",{children:Object(re.jsx)(j.a,{"aria-label":"setting",size:"small",onClick:function(){return function(){var e=String(window.location.search),t=-1!==e.indexOf("?")?"&":"?";e="".concat(e).concat(t);var n=window.location.href;window.open("".concat(n,"settings"),"","width=630,height=870,location=no,menubar=yes")}()},children:Object(re.jsx)(b.a,{})})})]})},ie=n(2),le=n(41),se=n(110),ue=n.n(se),de=n(232),pe=n(238),je=n(233),fe=n(237),be=n(225),me=n(226),xe=n(229),he=n(115),ve=n.n(he),Oe=n(112),ye=n.n(Oe),ge=n(114),we=n.n(ge),ke=n(113),Ce=n.n(ke),Ne=n(230),Pe=n(118),Se=n(241),Te=n(227),Re=n(228),Ie=n(55),De=function(e){var t={declaration:{attributes:{version:"1.0",encoding:"utf-8",standalone:"yes"}},elements:[]},n=e.map((function(e){return{type:"element",name:"Player",elements:[{type:"text",text:e}]}}));return t.elements.push({type:"element",name:"Priority",elements:n}),t},Ee=n(236),Be=n(239),ze=n(111),Ge=n.n(ze),Me=Object(h.a)((function(e){return{characterRow:{display:"flex",justifyContent:"space-between",padding:"7px 6px"},no:{marginRight:"6px"}}}));var Ae=function(e){var t=e.name,n=void 0===t?"":t,a=e.selectMe,r=e.index,c=e.onChangeSelectMe,o=e.onTextInput,i=e.removeHandle,l=e.hiddenAction,s=Me();return Object(re.jsxs)("div",{className:s.characterRow,children:[Object(re.jsxs)("div",{children:[Object(re.jsx)(x.a,{className:s.no,variant:"body2",component:"span",children:r+1}),Object(re.jsx)(Be.a,{size:"small",checked:a===r,value:r,onChange:function(){return c(r)}}),Object(re.jsx)(Ee.a,{id:"filled-search",label:"Character Name",value:n,type:"text",variant:"outlined",size:"small",onChange:function(e){return o(e.target.value,r)}})]}),!l&&Object(re.jsx)(j.a,{"aria-label":"remove",color:"secondary",size:"small",onClick:function(){return i(r)},children:Object(re.jsx)(Ge.a,{})})]})},Le={max:{fullParty:8,lightParty:4}},Ue=Object(h.a)((function(e){return{actionDiv:{display:"flex",justifyContent:"flex-end",marginTop:10},cancelBtn:{margin:"0px 10px"},dnone:{display:"none"}}}));var Fe=function(){var e=r.a.useState(!1),t=Object(z.a)(e,2),n=t[0],a=t[1],c=r.a.useState(null),o=Object(z.a)(c,2),i=o[0],l=o[1],s=r.a.useRef(null),d=r.a.useRef(null),p=Object(u.c)(V),f=Object(u.c)($),b=Object(u.b)();r.a.useEffect((function(){b(H())}),[n]);var m=function(){l(null)},x=function(e){m(),b(_(f.filter((function(t,n){return n!==e}))))},h=function(){var e=Object(k.a)(w.a.mark((function e(){var t,n,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{m(),t=De({}.players),n=Ie.js2xml(t),a=new Blob([n],{type:"text/xml"}),function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsDataURL(e)}(a,(function(e){d.current.href=e,d.current.innerText=e,d.current.download="Priority.xml",d.current.click()}))}catch(r){console.error(r)}case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=function(e,t){var n=f.map((function(n,a){return a===t?e:n}));b(_(n))},O=function(e){b(q(e))},y=function(){var e=Object(k.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b(ne({players:f,myNumber:p})),alert("Saved successful.");case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){var e=Le.max.fullParty;return f.length===e?"Full Party":"Light Party"}(),C=Ue(),N=[{title:"New",icon:Object(re.jsx)(ye.a,{fontSize:"small"}),action:function(){m(),f.length<Le.max.fullParty&&b(_([].concat(Object(G.a)(f),[""])))},disabled:f.length>=Le.max.fullParty},{title:"Import XML",icon:Object(re.jsx)(Ce.a,{fontSize:"small"}),action:function(){s.current.click()}},{title:"Export",icon:Object(re.jsx)(we.a,{fontSize:"small"}),action:h,disabled:!0,display:!1}];return Object(re.jsxs)("div",{children:[Object(re.jsxs)(be.a,{style:{paddingBottom:0},children:[Object(re.jsx)(me.a,{action:Object(re.jsx)(j.a,{onClick:function(e){l(e.currentTarget)},"aria-controls":"simple-menu","aria-haspopup":"true","aria-label":"more",children:Object(re.jsx)(ve.a,{})}),title:"".concat(g),titleTypographyProps:{variant:"h6"},subheader:"The ones who are suffering in UwU."}),Object(re.jsx)(Pe.a,{id:"simple-menu",anchorEl:i,keepMounted:!0,open:Boolean(i),onClose:m,children:N.map((function(e,t){return void 0===e.display||e.display?Object(re.jsxs)(Se.a,{onClick:e.action,disabled:void 0!==e.disabled&&e.disabled,children:[Object(re.jsx)(Te.a,{children:e.icon}),Object(re.jsx)(Re.a,{primary:e.title})]},t):""}))}),Object(re.jsx)(xe.a,{children:f.map((function(e,t){return Object(re.jsx)(Ae,{selectMe:p,index:t,name:e,onChangeSelectMe:O,onTextInput:v,removeHandle:x,hiddenAction:f.length<=1},t)}))})]}),Object(re.jsxs)("div",{className:C.actionDiv,children:[Object(re.jsx)(Ne.a,{variant:"contained",color:"secondary",className:C.cancelBtn,onClick:function(){a((function(e){return!e}))},children:"Reset"}),Object(re.jsx)(Ne.a,{variant:"contained",color:"primary",onClick:y,children:"Save"})]}),Object(re.jsx)("input",{type:"file",id:"import",ref:s,className:C.dnone,onChange:function(e){e.stopPropagation(),e.preventDefault(),m();var t=e.target.files[0],n=new FileReader;n.onload=function(e){try{var t=e.target.result,n=Ie.xml2js(t);if(!n)throw"The reault of file's content is invalid, result: ".concat(n);var a=n.elements[0].elements.map((function(e){return e.elements[0].text}));b(_(a))}catch(r){alert("Cannot import XML file, please try again."),console.error(r)}},n.readAsText(t)},onClick:function(e){return e.target.value=null}})]})},He=n(231);var Je=function(){var e=Object(h.a)((function(e){return{spaceTop:{marginTop:"30px"}}}))();return Object(re.jsx)("div",{children:Object(re.jsx)(be.a,{style:{paddingBottom:0},children:Object(re.jsxs)(xe.a,{children:[Object(re.jsx)(x.a,{variant:"h6",color:"textSecondary",children:"Gaol Overlay"}),Object(re.jsxs)(x.a,{variant:"subtitle2",color:"textSecondary",children:["Developed by ",Object(re.jsx)(He.a,{color:"primary",underline:"none",href:"https://na.finalfantasyxiv.com/lodestone/character/31961672/",target:"_blank",children:"Supskv"}),"."]}),Object(re.jsx)(x.a,{variant:"h6",color:"textSecondary",className:e.spaceTop,children:"Github"}),Object(re.jsx)(x.a,{variant:"subtitle2",color:"textSecondary",children:"See the latest code, changelog, and readme on Github. You can also submit bug reports or feature requests."}),Object(re.jsx)(He.a,{underline:"none",href:"https://github.com/supskv/gaol-plugin",target:"_blank",children:"https://github.com/supskv/gaol-plugin"}),Object(re.jsx)(x.a,{variant:"subtitle2",color:"textSecondary",className:e.spaceTop,children:"version 0.1.10-alpha"})]})})})},Xe=n(83),Ze=n.n(Xe);var _e=function(){var e=Object(a.useState)(""),t=Object(z.a)(e,2),n=t[0],r=t[1],c=Object(u.b)(),o=Object(h.a)((function(e){return{spaceTop:{marginTop:"30px"},actionDiv:{display:"flex",justifyContent:"center",marginTop:10},cancelBtn:{margin:"0px 10px"},importInput:{width:"100%"}}}))(),i=function(){var e=Object(k.a)(w.a.mark((function e(){var t,n,a,c,o;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,L.getItem("gaol");case 3:t=e.sent,n=t.players,a=De(n),c=Ie.js2xml(a),o=Ze.a.compressToEncodedURIComponent(c),r(o);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(re.jsx)("div",{children:Object(re.jsxs)(be.a,{style:{paddingBottom:0},children:[Object(re.jsx)(me.a,{title:"Import / Export",titleTypographyProps:{variant:"h6"}}),Object(re.jsxs)(xe.a,{children:[Object(re.jsx)(Ee.a,{id:"import-field",label:"Paste text here",multiline:!0,rows:10,className:o.importInput,variant:"outlined",size:"small",value:n,onChange:function(e){r(e.target.value),console.log(n)}}),Object(re.jsxs)("div",{className:o.actionDiv,children:[Object(re.jsx)(Ne.a,{variant:"contained",color:"secondary",className:o.cancelBtn,onClick:function(){try{var e=Ze.a.decompressFromEncodedURIComponent(n),t=Ie.xml2js(e);if(!t)throw"The reault of the compress is invalid, result: ".concat(t);var a=t.elements[0].elements.map((function(e){return e.elements[0].text}));c(ne({players:a})),alert("Imported Successful.")}catch(r){alert("Cannot import, please try again."),console.error(r)}},children:"Import"}),Object(re.jsx)(Ne.a,{variant:"contained",color:"primary",onClick:i,children:"Export"})]}),Object(re.jsx)(x.a,{variant:"subtitle2",color:"textSecondary",className:o.spaceTop,children:"- Import: Paste the code and click on import"}),Object(re.jsx)(x.a,{variant:"subtitle2",color:"textSecondary",children:"- Export: Generate code and copy to others"})]})]})})},qe=["children","value","index"];function We(e){var t=e.children,n=e.value,a=e.index,r=Object(ie.a)(e,qe);return Object(re.jsx)("div",Object(A.a)(Object(A.a)({role:"tabpanel",hidden:n!==a,id:"full-width-tabpanel-".concat(a),"aria-labelledby":"full-width-tab-".concat(a)},r),{},{children:n===a&&Object(re.jsx)(fe.a,{p:3,children:Object(re.jsx)(x.a,{children:t})})}))}function Ye(e){return{id:"full-width-tab-".concat(e),"aria-controls":"full-width-tabpanel-".concat(e)}}var Ke=function(){var e=Object(le.a)(),t=Object(h.a)((function(e){return{root:{background:e.palette.background.default,height:"inherit"}}}))(),n=r.a.useState(0),a=Object(z.a)(n,2),c=a[0],o=a[1];return Object(re.jsxs)("div",{className:t.root,children:[Object(re.jsx)(de.a,{position:"sticky",color:"default",children:Object(re.jsxs)(pe.a,{value:c,onChange:function(e,t){o(t)},indicatorColor:"primary",textColor:"primary",variant:"fullWidth","aria-label":"full width tabs example",children:[Object(re.jsx)(je.a,Object(A.a)({label:"General"},Ye(0))),Object(re.jsx)(je.a,Object(A.a)({label:"Import/Export"},Ye(1))),Object(re.jsx)(je.a,Object(A.a)({label:"About"},Ye(2)))]})}),Object(re.jsxs)(ue.a,{index:c,onChangeIndex:function(e){o(e)},children:[Object(re.jsx)(We,{value:c,index:0,dir:e.direction,children:Object(re.jsx)(Fe,{})}),Object(re.jsx)(We,{value:c,index:1,dir:e.direction,children:Object(re.jsx)(_e,{})}),Object(re.jsx)(We,{value:c,index:2,dir:e.direction,children:Object(re.jsx)(Je,{})})]})]})};var Qe=function(){return Object(re.jsx)(re.Fragment,{children:Object(re.jsx)(d.a,{children:Object(re.jsxs)(p.c,{children:[Object(re.jsx)(p.a,{exact:!0,path:"/",children:Object(re.jsx)(oe,{})}),Object(re.jsx)(p.a,{path:"/settings",children:Object(re.jsx)(Ke,{})})]})})})},Ve=Object(M.a)({reducer:{gaol:ae}}),$e=(n(183),Object(i.a)({palette:{type:"dark"}}));o.a.render(Object(re.jsx)(r.a.StrictMode,{children:Object(re.jsxs)(l.a,{theme:$e,children:[Object(re.jsx)(s.a,{}),Object(re.jsx)(u.a,{store:Ve,children:Object(re.jsx)(Qe,{})})]})}),document.getElementById("root"))}},[[184,1,2]]]);
//# sourceMappingURL=main.4c4ef9f9.chunk.js.map